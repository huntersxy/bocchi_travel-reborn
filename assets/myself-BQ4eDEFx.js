import{_,u as c,c as p,a as i,b as s,t as m,w as l,T as w,d,v as g,e as $,F as B,f as v,g as n,r as h,o as f,h as E,i as S,j as u}from"./index-DbY8GcTj.js";import{E as F}from"./el-button-B7tlxTPJ.js";import"./index-DFkpxPor.js";const T={class:"settings"},A={class:"lable"},V={class:"settingpage"},j={class:"setpage"},z={blur:!0},D={class:"setpage-flur"},N={class:"upload"},I={class:"avatarpage"},M={class:"up"},R=["src"],U={id:"about"},q={class:"user_img"},L=["src"],O={class:"user_name"},W={id:"name"},G={class:"signature"},H={key:0,class:"input",style:{"z-index":"500"}},J={key:1,class:"sign"},K={data(){return{userid:"",setname:"设置",setcount:3,setshow:0,id:1,name:"未登录",avatar:"//xiey.work/ava.png",mail:"",signature:"这个人很懒，什么都没写。",access_token:"",refresh_token:"",avatarFile:null,url:"",showavatarpage:0,previewImage:null,file:null,isEditing:!1}},methods:{toifollow(){this.$router.push(`/ifollow/${this.id}`)},tofollowme(){this.$router.push(`/followme/${this.id}`)},savesignature(){this.isEditing=!1,v.post(setapiurl.apiurl+"/user/signature",{signature:this.signature},{headers:{"access-token":this.access_token}}).then(a=>{console.log(a)}).catch(a=>{console.error(a)})},editsignature(){this.isEditing=!0,document.querySelector(".input").focus()},modavatarpage(){this.showavatarpage=!this.showavatarpage,console.log(this.showavatarpage)},onFileChange(a){const t=a.target.files[0];if(this.file=t,t){const e=new FileReader;e.onload=r=>{this.previewImage=r.target.result},e.readAsDataURL(t)}},putavatar(a){if(!a){this.warm=1;return}if(!a.type.startsWith("image/")){alert("请选择图片文件");return}if(a.size>4*1024*1024){alert("图片大小不能超过4MB");return}var t=new Date,e=t.getSeconds();console.log(e),v.put(setapiurl.apiurl+"/user/avatar/upload",{avatar_file:a},{headers:{"Content-Type":"multipart/form-data","access-token":this.access_token,Accept:"*/*"}}).then(r=>{console.log(r),this.avatar=r.data.user.avatar+"?"+e,this.modavatarpage(),this.warm=1}).catch(r=>{console.error(r)})},settings(){this.setshow=!this.setshow,this.setcount++},refreshtoken(){const a=c();v.get(a.apiurl+"/access_token/get",{headers:{"refresh-token":this.refresh_token,Accept:"*/*"}}).then(t=>{console.log(t),console.log(t.data.access_token),this.access_token=t.data.access_token,n.remove("access_token"),this.cookiesSet=n.set("access_token",t.data.access_token,{expires:1})}).catch(t=>{console.error(t)})},logout(){n.remove("id"),n.remove("access_token"),n.remove("refresh_token"),window.location.href="/"},init(){const a=c();a.increment,v.get(a.apiurl+"/user/info?user_id="+this.id,{headers:{"access-token":this.access_token}}).then(t=>{console.log(t),t.data.base.code=="10000"&&(console.log("获取信息成功"),this.name=t.data.user.name,this.avatar=t.data.user.avatar,this.mail=t.data.user.email,this.signature=t.data.user.signature,this.CookiesSet=n.set("avatar",this.avatar)),t.data.base.code=="10007"&&(console.log("不存在"),this.name="该用户不存在"),console.log(this.avatar),this.avatar===""&&(this.avatar="//xiey.work/ava.png"),this.signature===""&&(this.signature="这个人很懒，什么都没写。")}).catch(t=>{console.error(t)})}},mounted(){this.id=n.get("id"),this.access_token=n.get("access_token"),this.refresh_token=n.get("refresh_token"),this.init()},components:{},computed:{},watch:{setcount(a){a%2==1&&(this.setname="设置"),a%2!=1&&(this.setname="关闭")}},props:{},emits:{},setup(){}},P=Object.assign(K,{__name:"myself",setup(a){return c(),(t,e)=>{const r=h("a-page-header"),b=h("a-input"),y=h("a-button"),k=F,C=h("a-divider");return f(),p(B,null,[i(r,{style:{border:"1px solid rgb(235, 237, 240)","background-color":"#fff"},title:"个人中心","sub-title":"id:"+t.id,onBack:e[0]||(e[0]=()=>t.$router.go(-1))},null,8,["sub-title"]),s("div",T,[s("button",{class:"button",onClick:e[1]||(e[1]=(...o)=>t.settings&&t.settings(...o))},[e[13]||(e[13]=s("svg",{xmlns:"https://www.w3.org/2000/svg",width:"20",viewBox:"0 0 20 20",height:"20",fill:"none",class:"svg-icon"},[s("g",{"stroke-width":"1.5","stroke-linecap":"round",stroke:"#5d41de"},[s("circle",{r:"2.5",cy:"10",cx:"10"}),s("path",{"fill-rule":"evenodd",d:"m8.39079 2.80235c.53842-1.51424 2.67991-1.51424 3.21831-.00001.3392.95358 1.4284 1.40477 2.3425.97027 1.4514-.68995 2.9657.82427 2.2758 2.27575-.4345.91407.0166 2.00334.9702 2.34248 1.5143.53842 1.5143 2.67996 0 3.21836-.9536.3391-1.4047 1.4284-.9702 2.3425.6899 1.4514-.8244 2.9656-2.2758 2.2757-.9141-.4345-2.0033.0167-2.3425.9703-.5384 1.5142-2.67989 1.5142-3.21831 0-.33914-.9536-1.4284-1.4048-2.34247-.9703-1.45148.6899-2.96571-.8243-2.27575-2.2757.43449-.9141-.01669-2.0034-.97028-2.3425-1.51422-.5384-1.51422-2.67994.00001-3.21836.95358-.33914 1.40476-1.42841.97027-2.34248-.68996-1.45148.82427-2.9657 2.27575-2.27575.91407.4345 2.00333-.01669 2.34247-.97026z","clip-rule":"evenodd"})])],-1)),s("span",A,m(t.setname),1)])]),s("div",V,[i(w,{name:"fade"},{default:l(()=>[d(s("div",j,[s("mdui-list",z,[e[14]||(e[14]=s("text",null,"设置界面",-1)),s("mdui-list-item",{onClick:e[2]||(e[2]=(...o)=>t.refreshtoken&&t.refreshtoken(...o))},"刷新令牌"),s("mdui-list-item",{onClick:e[3]||(e[3]=(...o)=>t.logout&&t.logout(...o))},"退出登陆")])],512),[[g,t.setshow]])]),_:1}),d(s("div",D,null,512),[[g,t.setshow]])]),s("div",N,[i(w,{name:"fade"},{default:l(()=>[d(s("div",I,[s("div",M,[t.previewImage?(f(),p("img",{key:0,src:t.previewImage,alt:"预览图像",style:{"object-fit":"cover","border-radius":"20px 20px 0 0",width:"100%","max-height":"250px"}},null,8,R)):E("",!0),s("form",{onSubmit:e[4]||(e[4]=S((...o)=>t.uploadAvatar&&t.uploadAvatar(...o),["prevent"]))},[i(b,{type:"file",ref:"avatarInput",onChange:t.onFileChange,style:{"margin-top":"20px"},accept:"image/*"},{default:l(()=>e[15]||(e[15]=[u("上传文件")])),_:1},8,["onChange"])],32),i(y,{type:"primary submit",onClick:e[5]||(e[5]=o=>t.putavatar(t.file)),style:{"margin-bottom":"20px"}},{default:l(()=>e[16]||(e[16]=[u("上传头像")])),_:1})])],512),[[g,t.showavatarpage]])]),_:1}),d(s("div",{class:"avatarpage-flur",onClick:e[6]||(e[6]=(...o)=>t.modavatarpage&&t.modavatarpage(...o))},null,512),[[g,t.showavatarpage]])]),s("div",U,[s("div",q,[s("img",{src:t.avatar,class:"touxiangimg rounded-image",onClick:e[7]||(e[7]=(...o)=>t.modavatarpage&&t.modavatarpage(...o)),style:{"object-fit":"cover",width:"50vw",height:"50vw","max-width":"300px","max-height":"300px"}},null,8,L)]),s("div",O,[s("text",W,m(t.name),1)]),s("div",null,[i(k,{plain:"",onClick:t.toifollow},{default:l(()=>e[17]||(e[17]=[u("关注列表")])),_:1},8,["onClick"]),i(k,{plain:"",onClick:t.tofollowme},{default:l(()=>e[18]||(e[18]=[u("粉丝列表")])),_:1},8,["onClick"])]),e[20]||(e[20]=s("text",null,"个人签名",-1)),s("div",G,[t.isEditing?(f(),p("div",H,[d(s("input",{type:"text","onUpdate:modelValue":e[8]||(e[8]=o=>t.signature=o),onBlur:e[9]||(e[9]=o=>t.savesignature()),autofocus:"",style:{"z-index":"6665"}},null,544),[[$,t.signature]]),i(k,{plain:"",onClick:e[10]||(e[10]=o=>t.savesignature())},{default:l(()=>e[19]||(e[19]=[u("确认")])),_:1})])):(f(),p("div",J,[s("p",{onClick:e[11]||(e[11]=o=>t.editsignature())},m(t.signature),1)]))]),d(s("div",{class:"sign-flur",onClick:e[12]||(e[12]=o=>t.savesignature())},null,512),[[g,t.isEditing]]),s("text",null,"邮箱:"+m(t.mail),1)]),i(C,{orientation:"left",class:"separate"},{default:l(()=>e[21]||(e[21]=[u("评价")])),_:1}),e[22]||(e[22]=s("br",null,null,-1))],64)}}}),Z=_(P,[["__scopeId","data-v-41066a2f"]]);export{Z as default};
